<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>ShootPoints</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <script src="https://unpkg.com/mustache@latest/mustache.min.js"></script> -->
	<script src="lib/mustache.min.js"></script>
	<script type="text/javascript" src="scripts.js"></script>
	<link rel="stylesheet" href="styles.css">
</head>

<body onload="
	load_setup_errors();
	load_atmospheric_conditions();
	load_prism_offsets();
	load_sites_menus();
	load_classes_menus();
	load_geometries_menus();
	">
	<!-- htmx_render_442();
	htmx_reset_form_fields(); -->

	<div id="onTheFlyAdjustmentsPopup" hidden>
		<div class="sectionheader">
			On-The-Fly Adjustments
			<span style="float: right;"
				onclick="document.getElementById('onTheFlyAdjustmentsPopup').hidden=true">×&nbsp;</span>
		</div>
		<form id="setAtmosphericConditionsForm">
			<input type="button" id="setAtmosphericConditionsFormButton" value="Set Atmospheric Conditions"
				onclick="set_atmospheric_conditions();" /><br>
			<label for="setAtmosphericConditionsFormTemperature">Temperature (°C):</label>
			<input type="text" id="setAtmosphericConditionsFormTemperature" name="temperature" pattern="-?\d{1,2}"
				required />
			<label for="setAtmosphericConditionsFormPressure">Pressure (mmHg):</label>
			<input type="text" id="setAtmosphericConditionsFormPressure" name="pressure" pattern="[78]\d{2}" required />
		</form>
		<form id="setPrismOffsetsForm">
			<input type="button" id="setPrismOffsetsFormButton" value="Set Prism Offsets"
				onclick="set_prism_offsets();" />
			<span style="font-size: small"> (direction is from prism to point, as seen from the total
				station)</span><br>
			<label for="setPrismOffsetsVerticalDistance">Vertical Offset:</label>
			<input type="text" id="setPrismOffsetsVerticalDistance" name="vertical_distance"
				pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsVerticalDirection" name="vertical_direction">
				<option value="-1">Down</option>
				<option value="1">Up</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsVerticalDistance');">×</span><br>
			<label for="setPrismOffsetsLatitudeDistance">Latitude Offset:</label>
			<input type="text" id="setPrismOffsetsLatitudeDistance" name="latitude_distance"
				pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsLatitudeDirection" name="latitude_direction">
				<option value="1">North</option>
				<option value="-1">South</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsLatitudeDistance');">×</span><br>
			<label for="setPrismOffsetsLongitudeDistance">Longitude Offset:</label>
			<input type="text" id="setPrismOffsetsLongitudeDistance" name="longitude_distance"
				pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsLongitudeDirection" name="longitude_direction">
				<option value="1">East</option>
				<option value="-1">West</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsLongitudeDistance');">×</span><br>
			<label for="setPrismOffsetsRadialDistance">Radial Offset:</label>
			<input type="text" id="setPrismOffsetsRadialDistance" name="radial_distance" pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsRadialDirection" name="radial_direction">
				<option value="1">Away</option>
				<option value="-1">Toward</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsRadialDistance');">×</span><br>
			<label for="setPrismOffsetsTangentDistance">Tangent Offset:</label>
			<input type="text" id="setPrismOffsetsTangentDistance" name="tangent_distance"
				pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsTangentDirection" name="tangent_direction">
				<option value="1">Right</option>
				<option value="-1">Left</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsTangentDistance');">×</span><br>
			<label for="setPrismOffsetsWedgeDistance">Wedge Offset:</label>
			<input type="text" id="setPrismOffsetsWedgeDistance" name="wedge_distance" pattern="\d\.?(\.\d{1,2})?" />
			<select id="setPrismOffsetsWedgeDirection" name="wedge_direction">
				<option value="1">Clockwise</option>
				<option value="-1">Counter-Clockwise</option>
			</select>
			<span class="clearfield" onclick="clear_field('setPrismOffsetsWedgeDistance');">×</span><br>
		</form>
	</div>

	<!-- The following link is just a convenience for development, and should be removed once all the endpoints are mapped in the front end. -->
	<a href="/docs" style="float: right; color: white;">For the FastAPI interface, click here.</a>
	<img id="editAtmosphereAndPrismOffsets" src="img/gear.svg" onclick="show_on_the_fly_adjustments_popup()">
	<span class="info">
		<span id="atmosphericConditions">Atmosphere:</span><br>
		<span id="prismOffsets">Prism Offsets:</span>
	</span>

	<div id="outputBox"></div>

	<div class="setup">
		<div class="sectionheader" onclick="collapse_section(this);">
			Setup <span class="collapser">‣</span><span class="expander" hidden>▾</span>
		</div>

		<div class="sectionforms" hidden>
			<form id="setConfigsForm">
				<input type="button" id="setConfigsFormButton" value="Set Configs" onclick="set_configs();" /><br>
				<!-- TODO: Figure out how to pre-populate these fields with the current values -->
				<label for="setConfigsFormPort">Port:</label>
				<input type="text" id="setConfigsFormPort" name="port" />
				<label for="setConfigsFormMake">Make:</label>
				<input type="text" id="setConfigsFormMake" name="make" />
				<label for="setConfigsFormModel">Model:</label>
				<input type="text" id="setConfigsFormModel" name="model" />
				<label for="setConfigsFormLimit">Backsight Error Limit (cm):</label>
				<input type="text" id="setConfigsFormLimit" name="limit" pattern="\d{1,2}" />
			</form>

			<form id="saveNewSiteForm">
				<input type="button" id="saveNewSiteFormButton" value="Save New Site" onclick="save_new_site();" /><br>
				<label for="saveNewSiteFormSiteName">Name:</label>
				<input type="text" id="saveNewSiteFormSiteName" name="name" required />
				<label for="saveNewSiteFormSiteDescription">Description:</label>
				<input type="text" id="saveNewSiteFormSiteDescription" name="description" />
			</form>

			<form id="deleteSiteForm">
				<input type="button" id="deleteSiteFormButton" value="Delete Site" onclick="delete_site();" /><br>
				<label for="deleteSiteFormSitesMenu">Site:</label>
				<select id="deleteSiteFormSitesMenu" class="sitesmenu" name="sites_id"
					onchange="update_description(this, 'deleteSiteFormSiteDescription');" required>
				</select>
				<img class="infobutton" id="deleteSiteFormSiteDescription" src="img/info.svg">
			</form>

			<form id="saveNewStationForm">
				<input type="button" id="saveNewStationFormButton" value="Save New Station"
					onclick="save_new_station();" /><br>
				<label for="saveNewStationFormSitesMenu">Site:</label>
				<select id="saveNewStationFormSitesMenu" class="sitesmenu" name="sites_id"
					onchange="update_description(this, 'saveNewStationFormSiteDescription');" required>
				</select>
				<img class="infobutton" id="saveNewStationFormSiteDescription" src="img/info.svg">
				<label for="saveNewStationFormName">Name:</label>
				<input type="text" id="saveNewStationFormName" name="name" required />
				<label for="saveNewStationDescription">Description:</label>
				<input type="text" id="saveNewStationDescription" name="description" />
				<label for="saveNewStationCoordinateSystem">Coordinate System:</label>
				<select id="saveNewStationCoordinateSystem" name="coordinatesystem"
					onchange="update_required_new_site_fields(this);" required>
					<option></option>
					<option value='Site'>Site</option>
					<option value='UTM'>UTM</option>
					<option value='Lat/Lon'>Lat/Lon</option>
				</select><br>
				<label for="saveNewStationNorthing" id="saveNewStationNorthingLabel" hidden>Northing:</label>
				<input type="text" id="saveNewStationNorthing" name="northing" hidden />
				<label for="saveNewStationEasting" id="saveNewStationEastingLabel" hidden>Easting:</label>
				<input type="text" id="saveNewStationEasting" name="easting" hidden />
				<label for="saveNewStationLatitude" id="saveNewStationLatitudeLabel" hidden>Latitude:</label>
				<input type="text" id="saveNewStationLatitude" name="latitude" hidden />
				<label for="saveNewStationLongitude" id="saveNewStationLongitudeLabel" hidden>Longitude:</label>
				<input type="text" id="saveNewStationLongitude" name="longitude" hidden />
				<label for="saveNewStationElevation" id="saveNewStationElevationLabel" hidden>Elevation:</label>
				<input type="text" id="saveNewStationElevation" name="elevation" hidden />
				<label for="saveNewStationUTMZone" id="saveNewStationUTMZoneLabel" hidden>UTMZone:</label>
				<input type="text" id="saveNewStationUTMZone" name="utmzone" hidden />

			</form>

			<form id="deleteStationForm">
				<input type="button" id="deleteStationFormButton" value="Delete Station"
					onclick="delete_station();" /><br>
				<label for="deleteStationFormSitesMenu">Site:</label>
				<select id="deleteStationFormSitesMenu" class="sitesmenu" name="sites_id"
					onchange="update_description(this, 'deleteStationFormSiteDescription'); update_dependent_station_menu(this, 'deleteStationFormStationsMenu');"
					required>
				</select>
				<img class="infobutton" id="deleteStationFormSiteDescription" src="img/info.svg">
				<label for="deleteStationFormStationsMenu">Station:</label>
				<select id="deleteStationFormStationsMenu" name="stations_id"
					onchange="update_description(this, 'deleteStationFormStationDescription');" required>
				</select>
				<img class="infobutton" id="deleteStationFormStationDescription" src="img/info.svg">
			</form>

			<form id="saveNewClassForm">
				<input type="button" id="saveNewClassFormButton" value="Save New Class"
					onclick="save_new_class();" /><br>
				<label for="saveNewClassFormClassName">Name:</label>
				<input type="text" id="saveNewClassFormClassName" name="name" required />
				<label for="saveNewClassFormClassDescription">Description:</label>
				<input type="text" id="saveNewClassFormClassDescription" name="description" />
			</form>

			<form id="deleteClassForm">
				<input type="button" id=" deleteClassFormButton" value="Delete Class" onclick="delete_class();" /><br>
				<label for="deleteClassFormClassesMenu">Class:</label>
				<select id="deleteClassFormClassesMenu" class="classesmenu" name="classes_id"
					onchange="update_description(this, 'deleteClassFormClassDescription');" required>
				</select>
				<img class="infobutton" id="deleteClassFormClassDescription" src="img/info.svg">
			</form>

			<form id="saveNewSubclassForm">
				<input type="button" id="saveNewSubclassFormButton" value="Save New Subclass"
					onclick="save_new_subclass();" /><br>
				<label for="saveNewSubclassFormClassesMenu">Class:</label>
				<select id="saveNewSubclassFormClassesMenu" class="classesmenu" name="classes_id"
					onchange="update_description(this, 'saveNewSubclassFormClassDescription');" required>
				</select>
				<img class="infobutton" id="saveNewSubclassFormClassDescription" src="img/info.svg">
				<label for="saveNewSubclassFormSubclassName">Name:</label>
				<input type="text" id="saveNewSubclassFormSubclassName" name="name" required />
				<label for="saveNewSubclassFormSubclassDescription">Description:</label>
				<input type="text" id="saveNewSubclassFormSubclassDescription" name="description" />
			</form>

			<form id="deleteSubclassForm">
				<input type="button" id=" deleteSubclassFormButton" value="Delete Subclass"
					onclick="delete_subclass();" /><br>
				<label for="deleteSubclassFormClassesMenu">Class:</label>
				<select id="deleteSubclassFormClassesMenu" class="classesmenu" name="classes_id"
					onchange="update_description(this, 'deleteSubclassFormClassDescription'); update_dependent_subclass_menu(this, 'deleteSubclassFormSubclassesMenu')"
					required>
				</select>
				<img class="infobutton" id="deleteSubclassFormClassDescription" src="img/info.svg">
				<label for="deleteSubclassFormSubclassesMenu">Subclass:</label>
				<select id="deleteSubclassFormSubclassesMenu" name="subclasses_id"
					onchange="update_description(this, 'deleteSubclassFormSubclassDescription');" required>
				</select>
				<img class="infobutton" id="deleteSubclassFormSubclassDescription" src="img/info.svg">
			</form>
		</div>
	</div>

	<div class="usage">
		<div class="sectionheader" onclick="collapse_section(this);">
			Surveying <span class="collapser">‣</span><span class="expander" hidden>▾</span>
		</div>

		<div class="sectionforms" hidden>
			<form id="startNewSessionForm" hx-post="/session/" hx-target="#outputBox"
				hx-indicator="#startNewSessionFormIndicator" hx-ext="client-side-templates"
				mustache-template="outputtemplate" clearonsuccess>
				<input type="button" id="startNewSessionFormButton" value="Start New Session">
				<img id="startNewSessionFormIndicator" class="htmx-indicator" src="img/cylon.svg" hidden /><br>
				<label for="startNewSessionFormLabel">Label:</label>
				<input type="text" id="startNewSessionFormLabel" name="label"
					onclick="alert('Before proceeding, please verify that the atmospheric conditions are correct.')"
					required />
				<label for="startNewSessionFormSurveyor">Surveyor:</label>
				<input type="text" id="startNewSessionFormSurveyor" name="surveyor" required />
				<label for="startNewSessionFormSitesMenu">Site:</label>
				<select id="startNewSessionFormSitesMenu" class="sitesmenu" name="sites_id"
					onchange="update_description(this, 'startNewSessionFormSiteDescription'); update_dependent_station_menu(this, 'startNewSessionFormOccupiedPointMenu');"
					required>
				</select>
				<img class="infobutton" id="startNewSessionFormSiteDescription" src="img/info.svg">
				<label for="startNewSessionFormOccupiedPointMenu">Occupied Point:</label>
				<select id="startNewSessionFormOccupiedPointMenu" name="occupied_point_id" onchange="update_description(this, 'startNewSessionFormOccupiedPointDescription');
					update_backsight_station_menu(this);" required>
				</select>
				<img class="infobutton" id="startNewSessionFormOccupiedPointDescription" src="img/info.svg">
				<label for="startNewSessionFormSessionTypeMenu">Session Type:</label>
				<select id="startNewSessionFormSessionTypeMenu" name="sessiontype"
					onchange="update_required_new_session_fields(this);" required>
					<option></option>
					<option value="Backsight">Backsight</option>
					<option value="Azimuth">Azimuth</option>
				</select><br>
				<label for="startNewSessionFormBacksightStationMenu" id="startNewSessionFormBacksightStationMenuLabel"
					hidden>Backsight Station:</label>
				<select id="startNewSessionFormBacksightStationMenu" name="backsight_station_id"
					onchange="update_description(this, 'startNewSessionFormBacksightStationDescription');" hidden>
				</select>
				<img class="infobutton" id="startNewSessionFormBacksightStationDescription" src="img/info.svg" hidden>
				<label for="startNewSessionFormPrismHeight" id="startNewSessionFormPrismHeightLabel" hidden>Prism
					Height:</label>
				<input type="text" id="startNewSessionFormPrismHeight" name="prism_height" pattern="\d\.?(\.\d{1,2})?"
					hidden />
				<label for="startNewSessionFormInstrumentHeight" id="startNewSessionFormInstrumentHeightLabel"
					hidden>Instrument Height:</label>
				<input type="text" id="startNewSessionFormInstrumentHeight" name="instrument_height"
					pattern="\d\.?(\.\d{1,2})?" hidden />
				<label for="startNewSessionFormAzimuth" id="startNewSessionFormAzimuthLabel" hidden>Azimuth
					(ddd.mmss):</label>
				<input type="text" id="startNewSessionFormAzimuth" name="azimuth" pattern="\d{1,3}\.\d{4}" hidden />
			</form>

			<form id="startNewGroupingForm" hx-post="/grouping/" hx-target="#outputBox" hx-ext="client-side-templates"
				mustache-template="outputtemplate" clearonsuccess>
				<input type="button" id="startNewGroupingFormButton" value="Start New Grouping" /><br>
				<label for="startNewGroupingFormGeometriesMenu">Geometry:</label>
				<select id="startNewGroupingFormGeometriesMenu" class="geometriesmenu" name="geometry_id"
					onchange="update_description(this, 'startNewGroupingFormGeometryDescription');" required>
				</select>
				<img class="infobutton" id="startNewGroupingFormGeometryDescription" src="img/info.svg">
				<label for="startNewGroupingFormClassesMenu">Class:</label>
				<select id="startNewGroupingFormClassesMenu" class="classesmenu" name="classes_id"
					onchange="update_description(this, 'startNewGroupingFormClassDescription'); update_dependent_subclass_menu(this, 'startNewGroupingFormSubclassesMenu')"
					required>
				</select>
				<img class="infobutton" id="startNewGroupingFormClassDescription" src="img/info.svg">
				<label for="startNewGroupingFormSubclassesMenu">Subclass:</label>
				<select id="startNewGroupingFormSubclassesMenu" name="subclasses_id"
					onchange="update_description(this, 'startNewGroupingFormSubclassDescription');" required>
				</select>
				<img class="infobutton" id="startNewGroupingFormSubclassDescription" src="img/info.svg">
				<label for="startNewGroupingFormLabel">Label:</label>
				<input type="text" id="startNewGroupingFormLabel" name="label" required />
				<label for="startNewGroupingFormDescription">Description:</label>
				<input type="text" id="startNewGroupingFormDescription" name="description" />
			</form>

			<form id="takeShotForm" hx-get="/shot/" hx-target="#outputBox" hx-ext="client-side-templates"
				mustache-template="shotdatatemplate" onsubmit="show_shot_form(this.id);">
				<input type="button" id="takeShotFormButton" value="Take Shot" />
			</form>
			<form id="cancelShotForm" hx-get="/cancel/" hx-target="#outputBox" hx-ext="client-side-templates"
				mustache-template="outputtemplate" onsubmit="show_shot_form(this.id);" hidden>
				<input type="button" id="cancelShotFormButton" value="Cancel Shot" />
				<img id="takeShotFormIndicator" src="img/cylon.svg" /><br>
			</form>
			<form id="saveShotForm" hx-post="/shot/" hx-target="#outputBox" hx-ext="client-side-templates"
				mustache-template="outputtemplate" onsubmit="show_shot_form(this.id);" hidden>
				<input type="button" id="saveShotFormButton" value="Cancel Shot" />
				<img id="takeShotFormIndicator" src="img/cylon.svg" /><br>
			</form>
		</div>
	</div>
</body>
